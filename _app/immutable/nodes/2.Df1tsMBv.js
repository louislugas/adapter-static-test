import{S as e,i as t,s as o,o as r}from"../chunks/bkKGU34Z.js";import"../chunks/BzQdJGSh.js";import{z as n}from"../chunks/D5bNc6b2.js";function s(e,t){return e/2-3*t}function i(e){let t,o;r((()=>{t=document.getElementsByTagName("canvas"),o=[...t],o.forEach(((e,t)=>{t==o.length-1||e.remove()})),t=document.getElementsByTagName("canvas"),o=[...t]}));{let e=function(){width()>height()?(p=height()/6,m=s(width(),p),g=p/2):height()>width()&&(p=width()/6,g=s(height(),p),m=p/2)},t=function(e,t,o){add([sprite("bean"),pos(t,o),anchor("center"),area(),"tower",{grid_id:e}])},o=function(e,t,r){let n=u[0].children.map((e=>e.id)).findIndex((t=>t==e));u[0].children[n].tower&&(add([rect(12,12),area(),pos(t,r),anchor("center"),color(127,127,255),outline(4),move(RIGHT,d),offscreen({destroy:!0}),"bullet"]),wait(2,(()=>o(e,t,r))))},r=function(){add([sprite("ghosty"),area(),scale(p/64),pos(y+width()/3+100,w[randi(w.length)]+s(height(),64)),health(c),anchor("center"),"trash","enemy",{speed:rand(.5*h,1.5*h)}]),wait(5,r)},i=function(e){return{update(){const t=e*dt();this.scale.x+=t,this.scale.y+=t}}},a=function(e,t,o,r){for(let n=0;n<t;n++)wait(rand(.1*t),(()=>{for(let t=0;t<2;t++)add([pos(e.add(rand(vec2(-o),vec2(o)))),rect(4,4),scale(1*r,1*r),lifespan(.1),i(rand(48,72)*r),anchor("center")])}))};n({background:[74,48,82]});const d=400,h=120,c=2;let l=15;loadSprite("bean","/images/sprites/bean.png"),loadSprite("ghosty","/images/sprites/ghosty.png"),loadSprite("grass","/images/sprites/grass.png");let p=64,g=0,m=0;e(),onResize((()=>{e()})),addLevel(["######","######","######","######","######","######"],{tileWidth:p,tileHeight:p,pos:vec2(m,g),tiles:{"#":()=>[sprite("grass"),area(),anchor("center"),scale(p/64),"grid","ground","tile",{tower:!1,name:"grid"}]}});const u=get("*"),w=[...new Set(u[0].children.filter((e=>"grid"==e.name)).map((e=>e.pos.y)))],y=Math.max(...u[0].children.filter((e=>"grid"==e.name)).map((e=>e.pos.x)));let f=add([text(l),pos(width()/2,50),anchor("center")]);add([text("click the tile to add tower that'll shoot the enemy, it cost 5 points",{width:width()/2,size:24}),pos(width()/2,100),anchor("center")]),loop(2,(()=>{l++,f.text=l})),onClick("grid",(e=>{console.log("grid clicked"),e.tower?console.log("tower already exist"):l>=5&&(e.tower=!0,t(e.id,e.pos.x+s(width(),64),e.pos.y+s(height(),64)),l-=5,f.text=l)})),onAdd("tower",(e=>{o(e.grid_id,e.pos.x,e.pos.y)})),onUpdate("trash",(e=>{e.move(-e.speed,0),e.pos.x+e.width<width()/3&&destroy(e)})),onCollide("bullet","enemy",((e,t)=>{destroy(e),t.hurt(1),a(e.pos,1,24,1)})),on("hurt","enemy",(e=>{shake(1)})),on("death","enemy",(e=>{destroy(e),shake(2)})),onCollide("tower","enemy",((e,t)=>{destroy(t),destroy(e),u[0].children.filter((t=>t.id==e.grid_id))[0].tower=!1,shake(120),a(center(),12,120,30)})),r()}return[]}class a extends e{constructor(e){super(),t(this,e,i,null,o,{})}}export{a as component};
